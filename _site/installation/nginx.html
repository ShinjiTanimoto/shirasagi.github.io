<!DOCTYPE html>
<html lang="ja">
    <head>
    <meta charset="UTF-8">
    <title>nginx</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/github-light.css" media="screen">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/javascripts/script.js"></script>
  </head>
  <body>

    <section class="page-header">
      <h1 class="project-name"><a href="http://shirasagi.github.io">SHIRASAGI</a></h1>
    </section>

    <section class="main-content">
      <h1>nginx</h1>

      <h2>Install</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># vi /etc/yum.repos.d/CentOS-Base.repo
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=0
enabled=0
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># yum -y --enablerepo=nginx install nginx
# nginx -t
# /sbin/service nginx start
# /sbin/chkconfig nginx on
</code></pre></div>
<h2>シラサギの設定を追加する</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># vi /etc/nginx/conf.d/virtual.conf
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">server {
    listen 80;
    server_name example.jp;
    root /var/www/ss/public/sites/w/w/w/_/;

    location @app {
        if ($request_filename ~ .*\.(ico|gif|jpe?g|png|css|js)$) { access_log  off; }
        proxy_pass http://127.0.0.1:3000;
    }
    location / {
        expires 1h;
        try_files $uri $uri @app;
    }
    location /assets/ {
        root /var/www/ss/public/;
        expires 1h;
        access_log off;
    }
    location ~* \.(ico|css|js|gif|jpe?g|png)$ {
        expires 1h;
        access_log off;
        log_not_found off;
        try_files $uri $uri @app;
    }
}
</code></pre></div>
<h2>管理画面にBasic認証を設定する</h2>

<p>パスワードファイルを作成する。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># yum -y install httpd-tools
# cd /etc/nginx
# htpasswd -cm .htpasswd username
&gt; パスワードを入力する
</code></pre></div>
<p>設定を追加する。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># vi /etc/nginx/conf.d/virtual.conf
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">server {
    ...
    location /. {
        try_files $uri $uri @app;
        auth_basic &quot;Secret&quot;;
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}
</code></pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/shirasagi/shirasagi">SHIRASAGI</a> is maintained by <a href="https://github.com/shirasagi">SHIRASAGI Project</a>.</span>
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>
    </section>

  </body>
</html>
